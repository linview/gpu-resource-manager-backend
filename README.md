# GPUèµ„æºç®¡ç†ç³»ç»Ÿ

åŸºäºäº‹ä»¶é©±åŠ¨æ¶æ„çš„GPUèµ„æºç®¡ç†åå°ç³»ç»Ÿï¼Œæ”¯æŒè£¸é‡‘å±GPUæœåŠ¡å™¨çš„è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œç®¡ç†ã€‚

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªä¼ä¸šçº§GPUåŸºç¡€è®¾æ–½ç®¡ç†å¹³å°ï¼Œé‡‡ç”¨**æ¨¡å¼A: IaaSä½œä¸ºèµ„æºç¼–æ’å±‚**çš„æ¶æ„è®¾è®¡ï¼Œå®ç°GPUèµ„æºçš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸš€ **äº‹ä»¶é©±åŠ¨æ¶æ„**: åŸºäºNATS JetStreamçš„å®æ—¶äº‹ä»¶å¤„ç†
- ğŸ”§ **ç¡¬ä»¶è‡ªåŠ¨åŒ–**: é›†æˆTinkerbellå®ç°è£¸é‡‘å±æœåŠ¡å™¨è‡ªåŠ¨åŒ–éƒ¨ç½²
- ğŸ“Š **æ™ºèƒ½ç›‘æ§**: å®æ—¶GPUçŠ¶æ€ç›‘æ§å’Œå‘Šè­¦å…³è”åˆ†æ
- ğŸ”„ **äº‘åŸç”Ÿ**: åŸºäºKubernetesçš„å®¹å™¨åŒ–éƒ¨ç½²
- ğŸ›¡ï¸ **å®‰å…¨å¯é **: æ”¯æŒå¤šç§ç¡¬ä»¶ç®¡ç†åè®®(IPMI/Redfish/gNMI)

### æŠ€æœ¯æ ˆ

- **åç«¯**: Golang + Echo v4.11.4æ¡†æ¶
- **å®¹å™¨ç¼–æ’**: Kubernetes (k0s)
- **ç¡¬ä»¶ç®¡ç†**: Tinkerbell v0.12.2
- **æ“ä½œç³»ç»Ÿ**: Talos Linux
- **æ¶ˆæ¯é˜Ÿåˆ—**: NATS JetStream (MVP) / Kafka (ç”Ÿäº§ç¯å¢ƒ)
- **æ•°æ®åº“**: PostgreSQL + Redis + InfluxDB
- **ç›‘æ§**: Prometheus + Grafana

## æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
User â†’ IaaS â†’ K8s â†’ Tinkerbell â†’ Hardware
```

- **åº”ç”¨å±‚**: ç”¨æˆ·ç•Œé¢ã€APIç½‘å…³ã€IaaSæœåŠ¡
- **ç¼–æ’å±‚**: Kubernetesé›†ç¾¤ã€Tinkerbellã€CRDèµ„æº
- **ç¡¬ä»¶å±‚**: IPMIã€Redfishã€gNMIåè®®
- **åŸºç¡€è®¾æ–½å±‚**: Talos Linuxã€k0sé›†ç¾¤ã€Cloud-init

### äº‹ä»¶é©±åŠ¨æ¶æ„

ç³»ç»Ÿé‡‡ç”¨äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œé€šè¿‡NATS JetStreamå®ç°ç»„ä»¶é—´çš„æ¾è€¦åˆé€šä¿¡ï¼š

- **ç¡¬ä»¶å‘ç°äº‹ä»¶**: è‡ªåŠ¨å‘ç°å’Œæ³¨å†ŒGPUæœåŠ¡å™¨
- **çŠ¶æ€å˜åŒ–äº‹ä»¶**: å®æ—¶ç›‘æ§GPUçŠ¶æ€å˜åŒ–
- **å‘Šè­¦äº‹ä»¶**: æ™ºèƒ½å‘Šè­¦å…³è”åˆ†æ
- **é…ç½®å˜æ›´äº‹ä»¶**: è‡ªåŠ¨åŒ–é…ç½®ç®¡ç†

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Go 1.21+
- Docker & Docker Compose
- Kubernetesé›†ç¾¤ (å¯é€‰)
- ç¡¬ä»¶æœåŠ¡å™¨ (æ”¯æŒIPMI/Redfish)

### æœ¬åœ°å¼€å‘

1. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/your-org/palebluedot-backend.git
cd palebluedot-backend
```

2. **å®‰è£…ä¾èµ–**
```bash
go mod download
```

3. **é…ç½®ç¯å¢ƒå˜é‡**
```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶é…ç½®æ•°æ®åº“ç­‰è¿æ¥ä¿¡æ¯
```

4. **å¯åŠ¨ä¾èµ–æœåŠ¡**
```bash
cd deployments/docker
docker-compose up -d postgres redis nats
```

5. **è¿è¡Œåº”ç”¨**
```bash
go run cmd/server/main.go
```

### Dockeréƒ¨ç½²

1. **æ„å»ºé•œåƒ**
```bash
docker build -t palebluedot-backend:latest .
```

2. **å¯åŠ¨å®Œæ•´æœåŠ¡æ ˆ**
```bash
cd deployments/docker
docker-compose up -d
```

### Kuberneteséƒ¨ç½²

1. **éƒ¨ç½²Tinkerbell**
```bash
kubectl apply -f deployments/tinkerbell/tinkerbell-deployment.yaml
```

2. **éƒ¨ç½²GPUç®¡ç†ç³»ç»Ÿ**
```bash
kubectl apply -f deployments/kubernetes/k0s-cluster.yaml
```

## APIæ–‡æ¡£

### æ ¸å¿ƒAPIæ¥å£

#### GPUç®¡ç†
- `GET /api/v1/gpus` - è·å–GPUåˆ—è¡¨
- `GET /api/v1/gpus/{id}` - è·å–GPUè¯¦æƒ…
- `PUT /api/v1/gpus/{id}` - æ›´æ–°GPUä¿¡æ¯
- `GET /api/v1/gpus/{id}/status` - è·å–GPUçŠ¶æ€
- `GET /api/v1/gpus/{id}/metrics` - è·å–GPUæŒ‡æ ‡

#### æœåŠ¡å™¨ç®¡ç†
- `GET /api/v1/servers` - è·å–æœåŠ¡å™¨åˆ—è¡¨
- `POST /api/v1/servers` - åˆ›å»ºæœåŠ¡å™¨
- `POST /api/v1/servers/{id}/power` - ç”µæºæ§åˆ¶
- `GET /api/v1/servers/{id}/status` - è·å–æœåŠ¡å™¨çŠ¶æ€

#### èµ„æºåˆ†é…
- `GET /api/v1/allocations` - è·å–åˆ†é…åˆ—è¡¨
- `POST /api/v1/allocations` - åˆ›å»ºèµ„æºåˆ†é…
- `DELETE /api/v1/allocations/{id}` - é‡Šæ”¾èµ„æºåˆ†é…

#### å·¥ä½œæµç®¡ç†
- `GET /api/v1/workflows` - è·å–å·¥ä½œæµåˆ—è¡¨
- `POST /api/v1/workflows/deploy` - åˆ›å»ºéƒ¨ç½²å·¥ä½œæµ
- `POST /api/v1/workflows/cleanup` - åˆ›å»ºæ¸…ç†å·¥ä½œæµ

### ç¤ºä¾‹è¯·æ±‚

#### åˆ›å»ºGPUåˆ†é…
```bash
curl -X POST http://localhost:8080/api/v1/allocations \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user123",
    "server_id": "server456",
    "purpose": "AIè®­ç»ƒ"
  }'
```

#### è·å–GPUçŠ¶æ€
```bash
curl http://localhost:8080/api/v1/gpus/gpu-001/status
```

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `SERVER_PORT` | 8080 | æœåŠ¡ç«¯å£ |
| `DB_HOST` | localhost | æ•°æ®åº“ä¸»æœº |
| `DB_PORT` | 5432 | æ•°æ®åº“ç«¯å£ |
| `DB_USER` | postgres | æ•°æ®åº“ç”¨æˆ· |
| `DB_PASSWORD` | password | æ•°æ®åº“å¯†ç  |
| `REDIS_HOST` | localhost | Redisä¸»æœº |
| `NATS_URL` | nats://localhost:4222 | NATSè¿æ¥åœ°å€ |
| `TINKERBELL_URL` | http://localhost:50061 | Tinkerbell APIåœ°å€ |

### Tinkerbellé…ç½®

Tinkerbellé…ç½®æ–‡ä»¶ä½äº `deployments/tinkerbell/tinkerbell-config.yaml`ï¼ŒåŒ…å«ï¼š

- ç¡¬ä»¶ç®¡ç†åè®®é…ç½® (IPMI/Redfish/gNMI)
- æ“ä½œç³»ç»Ÿæ¨¡æ¿ (Talos Linux/Ubuntu)
- GPUé©±åŠ¨å®‰è£…è„šæœ¬
- ç½‘ç»œå’Œå­˜å‚¨é…ç½®

## ç›‘æ§å’Œå‘Šè­¦

### ç›‘æ§æŒ‡æ ‡

- **GPUæŒ‡æ ‡**: åˆ©ç”¨ç‡ã€æ¸©åº¦ã€åŠŸè€—ã€å†…å­˜ä½¿ç”¨
- **ç³»ç»ŸæŒ‡æ ‡**: CPUã€å†…å­˜ã€ç½‘ç»œã€ç£ç›˜
- **ä¸šåŠ¡æŒ‡æ ‡**: åˆ†é…æˆåŠŸç‡ã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡

### å‘Šè­¦è§„åˆ™

- GPUæ¸©åº¦è¶…è¿‡85Â°C
- GPUåˆ©ç”¨ç‡è¶…è¿‡95%
- å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡90%
- ç³»ç»Ÿé”™è¯¯ç‡è¶…è¿‡5%

### è®¿é—®ç›‘æ§ç•Œé¢

- **Grafana**: http://localhost:3000 (admin/admin)
- **Prometheus**: http://localhost:9090
- **Alertmanager**: http://localhost:9093

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
palebluedot-backend/
â”œâ”€â”€ cmd/server/           # åº”ç”¨å…¥å£
â”œâ”€â”€ internal/             # å†…éƒ¨åŒ…
â”‚   â”œâ”€â”€ api/             # APIå±‚
â”‚   â”œâ”€â”€ config/          # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ models/          # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ services/        # ä¸šåŠ¡æœåŠ¡
â”‚   â””â”€â”€ repository/      # æ•°æ®è®¿é—®å±‚
â”œâ”€â”€ pkg/                 # å…¬å…±åŒ…
â”œâ”€â”€ deployments/         # éƒ¨ç½²é…ç½®
â”œâ”€â”€ docs/               # æ–‡æ¡£
â””â”€â”€ tests/              # æµ‹è¯•
```

### å¼€å‘è§„èŒƒ

- éµå¾ªGoå®˜æ–¹ä»£ç è§„èŒƒ
- ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—è®°å½•
- ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶

### æµ‹è¯•

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
go test ./...

# è¿è¡Œé›†æˆæµ‹è¯•
go test -tags=integration ./...

# è¿è¡Œæ€§èƒ½æµ‹è¯•
go test -bench=. ./...
```

## éƒ¨ç½²æ¶æ„

### ç”Ÿäº§ç¯å¢ƒæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   è´Ÿè½½å‡è¡¡å™¨ (HAProxy/Nginx)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Kubernetesé›†ç¾¤ (k0s)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ GPUç®¡ç†API  â”‚ â”‚ Tinkerbell  â”‚ â”‚ ç›‘æ§æœåŠ¡    â”‚           â”‚
â”‚  â”‚ (å¤šå‰¯æœ¬)    â”‚ â”‚ (å•å‰¯æœ¬)    â”‚ â”‚ (å¤šå‰¯æœ¬)    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®å±‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ PostgreSQL  â”‚ â”‚ Redis       â”‚ â”‚ InfluxDB    â”‚           â”‚
â”‚  â”‚ (ä¸»ä»)      â”‚ â”‚ (é›†ç¾¤)      â”‚ â”‚ (é›†ç¾¤)      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é«˜å¯ç”¨é…ç½®

- **APIæœåŠ¡**: å¤šå‰¯æœ¬éƒ¨ç½²ï¼Œæ”¯æŒè‡ªåŠ¨æ‰©ç¼©å®¹
- **æ•°æ®åº“**: PostgreSQLä¸»ä»å¤åˆ¶
- **ç¼“å­˜**: Redisé›†ç¾¤æ¨¡å¼
- **æ¶ˆæ¯é˜Ÿåˆ—**: NATSé›†ç¾¤æ¨¡å¼
- **ç›‘æ§**: Prometheusè”é‚¦æ¨¡å¼

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Tinkerbellè¿æ¥å¤±è´¥**
   - æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
   - éªŒè¯è®¤è¯ä¿¡æ¯
   - æŸ¥çœ‹Tinkerbellæ—¥å¿—

2. **GPUå‘ç°å¤±è´¥**
   - æ£€æŸ¥ç¡¬ä»¶ç®¡ç†åè®®é…ç½®
   - éªŒè¯ç½‘ç»œè¿æ¥
   - æŸ¥çœ‹ç¡¬ä»¶æ—¥å¿—

3. **äº‹ä»¶å¤„ç†å¼‚å¸¸**
   - æ£€æŸ¥NATSè¿æ¥çŠ¶æ€
   - éªŒè¯äº‹ä»¶æ ¼å¼
   - æŸ¥çœ‹äº‹ä»¶å¤„ç†æ—¥å¿—

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker logs gpu-management-api

# æŸ¥çœ‹Tinkerbellæ—¥å¿—
docker logs gpu-management-tinkerbell

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker logs gpu-management-postgres
```

## è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤ä»£ç å˜æ›´
4. åˆ›å»ºPull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨Apache 2.0è®¸å¯è¯ï¼Œè¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## è”ç³»æ–¹å¼

- é¡¹ç›®ä¸»é¡µ: https://github.com/your-org/palebluedot-backend
- é—®é¢˜åé¦ˆ: https://github.com/your-org/palebluedot-backend/issues
- æ–‡æ¡£: https://github.com/your-org/palebluedot-backend/docs
